<!DOCTYPE html>

<html lang='en'>

<meta charset="utf-8">

<head>
    <title>Leaflet TileLayer.GL Mandelbrot demo</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.0.1/dist/leaflet-src.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="./Leaflet.TileLayer.GL.js"></script>
    <script src="https://unpkg.com/js-big-decimal@1.3.1/dist/web/js-big-decimal.min.js"></script>
</head>

<body>
    <div id="map" style='width:100vw; height: 100vh;'></div>
    <script type="text/javascript">
        var fragmentShader = `
int fractal(void) {
	float cx = vCRSCoords.x;
	float cy = vCRSCoords.y;
	float x = 0.0;
	float y = 0.0;
	float tempX = 0.0;
	int i = 0;
	int runaway = 0;
	for (int i=1; i < 200; i++) {
		tempX = x * x - y * y + float(cx);
		y = 2.0 * x * y + float(cy);
		x = tempX;
		if (runaway == 0 && x * x + y * y > 100.0) {
			runaway = i;
			break;
		}
	}
	return runaway;
}

void main(void) {
	int steps = 0;
	float blue;
	float yellow;
	steps = fractal();
	if (steps != 0) {
		blue = float(steps) / 100.0;
		yellow = blue / 4.0;
		gl_FragColor = vec4(yellow, yellow, blue, 1.0);
	} else {
		gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
	}
}
`;
        var tileSize = 256;
        var map = L.map('map', {
            crs: L.CRS.Simple,
            minZoom: 7,
            maxZoom: 22

        }).setView([0, -0.5], 5);
        var fractal = L.tileLayer.gl({
            fragmentShader: fragmentShader,
            // tileUrls: []
        }).addTo(map);
    </script>
</body>

</html>